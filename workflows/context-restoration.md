---
description: 本规范为AI在接收到“进度快照”并重启工作会话时，定义了一套标准的上下文恢复与工作继续流程。核心目标是让AI快速、准确地吸收项目历史背景与当前进度，并基于对现有代码的风格分析，确保后续产出与项目整体保持高度一致。此流程旨在消除新会话的“冷启动”问题，保证开发工作的连续性、一致性和安全性，避免因上下文断裂导致的设计偏差或代码冲突。
---

# 规范：上下文恢复与工作继续流程 (Context Restoration & Resumption)

## 1. 触发条件 (Trigger)

- 在一个新会话开始时，用户提供了上一份 `进度快照 (Progress Snapshot)` 文档。

## 2. 核心目标 (Core Goal)

1.  **快速吸收 (Absorb)**: 深入理解项目的历史背景、当前进度和既定决策。
2.  **保证一致 (Ensure Consistency)**: 分析现有代码的风格和模式，确保新代码无缝集成。
3.  **无缝继续 (Resume Seamlessly)**: 基于快照中的“下一步计划”继续推进工作，不产生偏差。

## 3. AI执行流程 (AI Execution Flow)

AI在接收到进度快照后，**必须**严格遵循以下步骤：

### **第1步：确认与解析 (Acknowledge & Parse)**
- **动作**: 首先向用户确认已收到快照。然后，在内部解析快照的各个部分（项目目标、当前任务、关键决策、代码状态等）。
- **示例AI输出**: "好的，已收到您的进度快照。正在解析当前项目状态……"

### **第2步：内化上下文 (Internalize Context)**
- **动作**: 仔细阅读快照的**前三部分**（项目目标、当前任务、关键决策）。将这些信息作为后续所有思考和行动的最高准则。
- **内部思考**: “项目的目标是X，我们正在做Y，并且已经决定了Z。我接下来的所有建议和代码都不能违背这些原则。”

### **第3步：代码风格分析与对齐 (Analyze Code Style & Align)**
- **动作**: 这是**最关键**的一步。在编写任何新代码之前，**必须**仔细分析快照中`代码状态`部分提供的所有代码片段。
- **分析要点**:
    - **命名约定**: 变量是 `snake_case` 还是 `camelCase`？
    - **函数/类结构**: 函数的复杂度和长度如何？是否倾向于使用类或纯函数？
    - **设计模式**: 是否有明显的设计模式（如依赖注入、工厂模式）？
    - **注释风格**: 注释的频率和风格是怎样的？
    - **错误处理**: 是倾向于返回`None`，还是抛出异常？
- **内部对齐**: AI需要在内部形成一个临时的**“项目风格画像”**，并承诺后续所有代码生成都将严格模仿此画像，以确保风格统一。

### **第4步：确认理解并制定计划 (Confirm Understanding & Plan)**
- **动作**: 在完成分析后，向用户进行一次简短的总结，以证明自己已完全理解上下文，并明确接下来的行动计划。
- **示例AI输出**: 
  > “好的，上下文已同步。
  >
  > - **当前目标**: 继续完成密码重置功能。
  > - **关键约束**: Token有效期为1小时，使用JWT。
  > - **代码风格**: 我注意到项目统一使用`snake_case`命名、FastAPI的依赖注入模式以及Google风格的Docstrings。
  > - **下一步计划**: 我将开始执行快照中的下一步：‘完成`/forgot-password`端点的数据库查询和邮件发送逻辑’。
  >
  > 准备好后，请告诉我即可开始。”

### **第5步：执行任务 (Execute Task)**
- **动作**: 开始执行“下一步计划”。在生成的所有新代码或修改中，严格遵守在第3步中分析并对齐的代码风格和项目规范，确保新增部分不会影响原有项目的功能和一致性。